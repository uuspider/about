---
layout: post
title: Image processing & PIL
---

<script type="text/javascript" src="{{site.baseurl}}/MathJax-2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

## Image Processing & PIL

参考：[Keras Documentation][ref1]{:target="_blank"}, [Keras文档][ref2]{:target="_blank"}, [卷积神经网络][ref3]{:target="_blank"}, [机器学习][ref4]{:target="_blank"}

[ref1]:https://keras.io/
[ref2]:http://keras-cn.readthedocs.io/en/latest/
[ref3]:https://www.zybuluo.com/hanbingtao/note/485480
[ref4]:http://www.jianshu.com/p/28f02bb59fe5

<h2 id="top"></h2>

***

*   [PIL安装](#setup)
*   [图像模式](#mode)
    *   [神经元](#perceptron)
    *   [神经元的训练](#perceptron_train)
    *   [神经网络](#neural_network_m)
    *   [反向传播算法](#back_propagation)
    *   [梯度检查](#check)
    *   [ReLU函数](#relu)
    *   [softmax函数](#softmax)
    *   [回归](#regressor)
    *   [分类](#classification)
*   [卷积神经网络](#convolutional_neural_network)
    *   [从全连接到卷积](#dese_cnn)
    *   [CNN的架构](#cnn_stucture)
    *   [卷积层输出值的计算](#con_output)
    *   [池化层输出值的计算](#pool_output)
    *   [卷积神经网络的训练](#cnn_train)
    *   [CNN分类](#cnn_c)
*   [循环神经网络](#convolutional_neural_network)


***

## 安装 {#setup}

    $ pip install -I --no-cache-dir -v Pillow

或

    $ sudo apt-get install python-imaging

***

## 图像模式 {#mode}

### 1

二值图像，非黑即白，每个像素存储为8bit，0为黑，255为白。

### L

灰度图像，每个像素存储为8bit，0为黑，255为白。从RGB转为L的公式为：

L = (299R+587G+114B)/1000  (取整数)

### P

彩色图像，每个像素存储为8bit，色值从调色板中查询(使用调色板映射到其它模式)。

### RGB

真彩色图像，每个像素存储为3×8bit，依次用8bit表示红、绿、蓝通道。

### RGBA

有透明通道的真彩色图像，每个像素存储为4×8bit，依次为红、绿、蓝、透明通道，255表示完全不透明。

### CMYK

彩色图像，每个像素存储为4×8bit，依次为Cyan青、Magenta品红、Yellow黄、黑KeyPlate，即印刷三原色加黑色。

C=255-R, M=255-G, Y=255-B, K=0

### YCbCr

彩色视频，每个像素存储为3×8bit，依次为Y亮度、Cb蓝色色度、Cr红色色度。

Y = 0.257R+0.504G+0.098B+16

Cb = -0.148R-0.291G+0.439B+128

Cr = 0.439R-0.368G-0.071B+128

### I

整型灰度图像，每个像素存储为32bit，0为黑，255为白。公式同“L”。

### F

浮点灰度图像，每个像素存储为32bit，0为黑，255为白。公式同“L”。


向RGB转换时，1、L、I、F直接将色值复制为三通道，P通过逆向查询RGB值，RGBA、CMYK丢弃第四通道，YCbCr按照公式进行转换。

**[[TOP](#top)]**

***

## Image实例属性

`lena.format`： 图像格式，由PIL创建的图像为None。

`lena.mode`： 图像模式。

`lena.size`： 元组(w, h)。

`lena.palette`： "P"模式下的palette实例或None。

`lena.info`： 字典，包含图像属性信息。

**[[TOP](#top)]**

***

## Image类的函数

`Image.new("RGB", (128,128), "#FF0000")`： 创建128×128的红色图像，color为十六进制色符，或red、blue等颜色，默认为0。

`Image.open('filepath/filename', 'r')`： 打开图像，mode必须为'r'或不设置。

`Image.blend(lena_1, lena_2, alpha)`： 叠加图像，alpha为透明度，当alpha=0时为lena_1，alpha=1时为lena_2，计算公式为：lena_1*(1.0-alpha)+lena_2*alpha。

`Image.composite(lena_1, lena_2, mask)`： 叠加图像，mask为蒙版图像，作为透明度，其模式可为1、L或RGBA。

`Image.save('filepath/filename')`： 保存图像。

`Image.eval(lena, fun)`： 使用fun函数处理lena中的每一个像素，若有多个通道，每个通道值都会处理一次，如：

    def fun(x):
        return x*0.5
    Image.eval(lena, fun)

`Image.merge("RGB", lena)`： 使用单通道创建图像，如：

    r1, g1, b1 = lena_1.split()
    r2, g2, b2 = lena_2.split()
    lena = [r1, g2, b2] # 或(r1, g2, b2)
    Image.merge("RGB", lena)

**[[TOP](#top)]**

***

## Image实例方法

`lena.convent(mode)`： 将图片转换为mode模式。

`lena.convent(mode, [dither|palette|colors])`： 使用调色板的转换。

`lena.convent("L|RGB", matrix)`： 带矩阵的模式转换，只适用于L或RGB图像，matrix为4~16元组。

`lena.copy()`： 复制图像。

`lena.crop(box)`： 裁剪box区域，box=(x0, y0, x1, y1)。PIL使用笛卡尔像素坐标系统，坐标(0, 0)位于左上角。注意：坐标值表示像素的角；位于坐标(0, 0)处的像素的中心实际上位于(0.5, 0.5)。

`lena.draft(mode, size)`： 按照给定的模式和尺寸修改原图。

`lena.filter(FILTER)`： 使用FILTER过滤器，详细可查看ImageFilter模块文档。




**[[TOP](#top)]**

***
