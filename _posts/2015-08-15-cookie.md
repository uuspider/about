---
layout: post
title: cookie basic
---
## 解析cookie

<h2 id="top"></h2>

***

*   [引言](#preface)
*   [cookie 组成](#constant)
*   [Unix 时间戳](#timestamp)
*   [安全管理](#secure)

***

## 引言 {#preface}

在HTML出现初期，网页只包含一些文字和图片，客户端发出请求，服务器返回相应的内容，不需要区分这些请求来自哪个客户端。随着网络技术的发展，客户端与服务器之间的联系变得越来越复杂，服务器需要根据不同客户端的请求返回不同的内容，也就是说，服务器需要区分请求信息来自哪个客户端，于是，cookie应运而生，开始大行其道。

访问某站点时，客户端向服务器发出HTTP request，服务器返回HTTP response，如果该网站需要设置cookie，返回客户端的HTTP response中就包含Set-Cookie指令，客户端收到指令就会在系统中存储相应的cookie信息；当再次访问该站点时，客户端就会提取系统中存储的cookie信息，放在HTTP request中发给服务器，服务器根据cookie的“名称”和“值”，返回HTTP response。可见，通过cookie，服务器可以有效地区分发出请求信息的客户端，从而做出不同的响应，也就是说，cookie是服务器在客户端存储数据并以此跟踪和识别用户身份的一种机制。

受HTTP header长度的限制，cookie一般都小于4096字节；同一站点存储在本地系统的cookie数量最多为20个，如果设置的cookie超过20个，最早的cookie会被删除。

**[[TOP](#top)]**

***

## cookie 组成 {#constant}

cookie由名称、值、路径、域、协议、生存周期以及HttpOnly属性组成，不同客户端保存cookie的形式稍有不同。

    # Netscape HTTP Cookie File
    # http://curl.haxx.se/docs/http-cookies.html
    # This file was generated by libcurl! Edit at your own risk.
    
    .xxx.com TURE / FALSE 1451577601 cookiename value
    Domain Flag Path Secure Expiration Name Value

这是Netscape格式的cookie文件，每一行表示一个cookie，元素之间以制表符分隔。

|:---|:---|
|Domain|可使用该cookie的域|
|Flag|是否允许所有子域使用该cookie|
|Path|cookie的服务器路径|
|Secure|是否需要安全连接(HTTPS)|
|Expiration|过期时间，以Unix时间戳表示|
|Name|cookie名称|
|Value|cookie值|

<br>

**[[TOP](#top)]**

***

## Unix 时间戳 {#timestamp}

Unix时间戳(Unix epoch, Unix time, POSIX time, Unix timestamp)是从1970年1月1日0时0分0秒(UTC/GMT)开始所经过的秒数，不考虑闰秒。

在linux中可以方便地实现时间戳与普通时间的转换。

    $ date +%s -d"Jan 1, 2016 00:00:01"
    1451577601
    $ date -d @1451577601
    [...]
    
**[[TOP](#top)]**

***

## 安全管理 {#secure}

cookie默认是明文保存的，为了安全，客户端只会让cookie创建网站访问，即便如此，cookie仍然有泄露的风险，如通过XSS脚本攻击就可以截获cookie信息，一旦获取到cookie，不需要使用用户名和密码，就可以冒充用户身份直接登陆网站。

为了保证cookie数据的保密性，以及不被伪造或者篡改，现在通常需要对cookie内容进行加密，加密方式一般使用对称加密(单密钥，如DES)或非对称加密(一对密钥，如RSA)，密钥保存在服务器端，如果不能提供正确的密钥，就无法对数据进行解密，也无法伪造或篡改数据。此外，重要的cookie数据通常会设置HttpOnly属性，避免跨站脚本获取cookie，保证了cookie在客户端的安全性；还可以设置Secure为TRUE，这样cookie只会在HTTPS下传输，保证了cookie在服务器端的安全性。
    
**[[TOP](#top)]**

***
