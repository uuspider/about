---
layout: post
title: git guide
---
## git 指引

参考：[git简明指南][ref1]{:target="_blank"}, [廖雪峰git教程][ref2]{:target="_blank"}, [猴子都能懂的git教程][ref3]{:target="_blank"}, [Pro Git][ref4]{:target="_blank"}

[ref1]:http://rogerdudler.github.io/git-guide/index.zh.html
[ref2]:http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000
[ref3]:http://backlogtool.com/git-guide/cn/
[ref4]:https://git-scm.com/book/zh

<h2 id="top"></h2>

***

*   [安装](#setup)
*   [启动服务](#service)
*   [模板](#template) : [简单模板](#basic_template) \| [变量](#var) \| [流程控制](#stream)
*   [静态路由](#static)
*   [表单](#form)
*   [数据库](#database): [新建表](#newtable) \| [插入](#insert) \| [查询](#select) \| [更新](#update) \| [删除](#delete)

***

git是分布式版本控制系统，每个客户端都保存了整个**代码仓库**，在本地对文件进行修改后，保存在暂存区域，最后再提交更新，在此过程中，只有提交更新需要连接网络，因此，git对版本控制的操作并不依赖网络，便于保持数据的完整性和版本历史的洁净。

## 安装 {#setup}

    $ sudo apt-get install git

初次运行git之前需要配置一些参数和变量，包括`/etc/gitconfi`、`~/.gitconfi`或`~/.config/git/config`以及当前使用仓库git目录中的`config`(.git/config)，这三个文件中，后一个配置会覆盖上一级别的配置。需要配置的参数和变量包括：

### 用户信息

    $ git config --global user.name "Tom King"
    $ git config --global user.email wtking@gmail.com

git会把用户名和email写入每一次版本提交，并且不可更改。这里`--global`选项是针对全系统设置的，如果针对特定项目使用不同用户名和email时，就不要使用该选项。

### 编辑器

git默认使用vim，如果想使用emacs，可以这样配置：

    $ git config --global core.editor emacs

### 查看配置信息

    $ git config --list # 查看所有配置
    $ git config user.name # 查看指定项配置

### 帮助

    $ git help config
    $ git config --help
    $ man git-config


**[[TOP](#top)]**

***

## 启动服务 {#service}

    $ cat run.py
    from flask import Flask

    app = Flask(__name__)

    @app.route('/')
    def index():
        return '<h1>Hello Flask</h1>'

    if __name__ == '__main__':
        app.run()

    $ python run.py
    * Running on http://127.0.0.1:5000/

在本机浏览器上打开 http://127.0.0.1:5000/ 即可看到运行结果。要从网络上访问服务，需要设置`host`：

    $ cat run.py
    ...
    if __name__ == '__main__':
        app.run(host='0.0.0.0', port=5000, debug=True)

    $ python run.py
    * Running on http://0.0.0.0:5000/

在生产环境下，可采用"nginx反向代理+gunicorn"的方案部署服务器：

    $ pip install gunicorn
    $ sudo apt-get install nginx
    $ cat run.py
    ...
    if __name__ == '__main__':
        app.run()
    $ cat /etc/nginx/conf.d/default.conf
    server {
        listen       80 default_server;
        server_name  0.0.0.0;
        location / {
            proxy_pass  http://127.0.0.1:8080;
        }
    }

    $ sudo gunicorn -b 127.0.0.1:8080 run:app
    [2017-03-18 23:17:46 +0000] [3791] [INFO] Starting gunicorn 19.6.0
    [2017-03-18 23:17:46 +0000] [3791] [INFO] Listening at: http://127.0.0.1:8080 (3791)
    [2017-03-18 23:17:46 +0000] [3791] [INFO] Using worker: sync
    [2017-03-18 23:17:46 +0000] [3796] [INFO] Booting worker with pid: 3796

文件目录：

    - run.py

**[[TOP](#top)]**

***

## 模板 {#template}

### 简单模板  {#basic_template}

    $ pip install Jinja2
    $ cat run.py
    from flask import Flask, render_template

    app = Flask(__name__)

    @app.route('/')
    def index():
        return render_template('index.html')

    if __name__ == '__main__':
        app.run(host='0.0.0.0', port=5000, debug=True)

    $ cat templates/index.html
    <html>
        <head><title>Flask</title></head>
        <body><h1>Hello World</h1></body>
    </html>

    $ python run.py
    * Running on http://0.0.0.0:5000/

文件目录：

    - run.py
    |- templates/index.html

### 模板中的变量 {#var}

    $ cat run.py
    from flask import Flask, render_template

    app = Flask(__name__)

    @app.route('/')
    def index():
        return render_template('index.html')
    def upage(user):
        return render_template('upage.html', name=user)

    if __name__ == '__main__':
        app.run(host='0.0.0.0', port=5000, debug=True)

    $ cat templates/upage.html
    <html>
      <head><title>Flask</title></head>
      <body><h1>Hello, { { name } }</h1></body>
    </html>

    $ python run.py
    * Running on http://0.0.0.0:5000/

浏览器把输入的`user`的值传递给脚本中的`name`，`name`对应模板中的 `{ { name } }`。

文件目录：

    - run.py
    - templates/
    | - index.html
    | - upage.html

### 模板中的控制结构 {#stream}

条件判断：

    $ cat templates/upage.html
    <html>
      <head><title>Flask</title></head>
      <body>
        { % if name % }
          <h1>Hello, { { name } }</h1>
        { % else % }
          <h1>Hello, Flask</h1>
        { % endif % }
      </body>
    </html>

循环：

    $ cat templates/upage.html
    <html>
      <head><title>Flask</title></head>
      <body>
        { % for user in name % }
          <h1>Hello, { { user } }</h1>
        { % endfor % }
      </body>
    </html>

衍生模板：

    $ cat templates/index.html
    <html>
      <head><title>Flask</title></head>
      <body><h1>Hello World</h1></body>
    </html>
    { % extends "upage.html" % }

    $ cat templates/upage.html
    <html>
      <head><title>Flask</title></head>
      <body><h1>Hello Flask</h1></body>
    </html>

文件目录：

    - run.py
    - templates/
    | - index.html
    | - upage.html

**[[TOP](#top)]**

***

## 静态路由 {#static}

    $ cat templates/index.html
    <html>
      <head>
        <title>Flask</title>
        <link rel="shortcut icon" href="{ { url_for('static', filename = 'i32.ico') } }" type="image/x-icon">
      </head>
      <body>
        <h1>Hello World</h1>
      </body>
    </html>

文件目录：

    - run.py
    - templates/
    | - index.html
    - static/
    | - i32.ico

**[[TOP](#top)]**

***

## 表单 {#form}

    $ pip install flask_wtf
    $ cat run.py
    from flask import Flask, render_template, request
    from flask.ext.wtf import Form
    from wtforms import StringField, SubmitField, PasswordField
    from wtforms.validators import Required

    app = Flask(__name__)
    app.config['SECRET_KEY'] = '******'

    class NameForm(Form):
        name = StringField('user:', valiators = [Required()])
        passwd = PasswordField('password:',validators = [Required()])
        submit = SubmitField('submit')

    @app.route('/')
    def index():
        return render_template('index.html')
    def upage(user):
        return render_template('upage.html', name=user)

    @app.route('/submit')
    def submit_form():
        name = None
        form = NameForm()
        if form.validate_on_submit():
            name = form.name.data
            form.name.data = ''
        return render_template('submit.html',form=form,name=name)

    @app.route('/submit', methods=['GET','POST'])
    def submit():
        return request.form['name']+'</br>'+request.form['passwd']

    if __name__ == '__main__':
        app.run(host='0.0.0.0', port=5000, debug=True)

    $ cat templates/submit.html
    <html>
      <head><title>Flask</title></head>
      <body>
        <from method="POST",action="/submit">
          { { form.hidden_tag() } }
          { { form.name.label } }{ { form.name() } }</br>
          { { form.passwd.label } }{ { form.passwd() } }</br>
          { { form.submit() } }
        </form>
      </body>
    </html>

    $ python run.py
    * Running on http://0.0.0.0:5000/

文件目录：

    - run.py
    - templates/
    | - index.html
    | - upage.html
    | - submit.html

**[[TOP](#top)]**

***

## 文件 {#files}

    $ pip install flask_uploads
    $ cat run.py
    #!/usr/bin/env python
    # -*- coding: utf-8 -*-
    import os
    from flask import Flask, render_template, redirect, url_for, request
    from flask_uploads import UploadSet, configure_uploads, IMAGES, patch_request_class
    from flask_wtf import FlaskForm
    from flask_wtf.file import FileField, FileRequired, FileAllowed
    from wtforms import SubmitField

    app = Flask(__name__)
    app.config['SECRET_KEY'] = '******'
    app.config['UPLOADED_PHOTOS_DEST'] = '/flasky/files/'

    filesToUp = UploadSet('files', FILES)
    configure_uploads(app, filesToUp)
    patch_request_class(app)  # set maximum file size, default is 16MB

    class UploadForm(FlaskForm):
        file = FileField(validators=[FileAllowed(photos, u'Image Only!'), FileRequired(u'Choose a file!')])
        submit = SubmitField(u'Upload')

    @app.route('/')
    def index():
        return render_template('index.html')
    def upage(user):
        return render_template('upage.html', name=user)

    @app.route('/submit')
    def submit_form():
        name = None
        form = NameForm()
        if form.validate_on_submit():
            name = form.name.data
            form.name.data = ''
        return render_template('submit.html',form=form,name=name)

    @app.route('/submit', methods=['GET','POST'])
    def submit():
        return request.form['name']+'</br>'+request.form['passwd']


    @app.route('/upload', methods=['GET', 'POST'])
    def upload_file():
        form = UploadForm()
        if form.validate_on_submit():
            for filename in request.files.getlist('photo'):
                name = hashlib.md5('admin' + str(time.time())).hexdigest()[:15]
                photos.save(filename, name=name + '.')
            success = True
        else:
            success = False
        return render_template('upload.html', form=form, success=success)


    @app.route('/manage')
    def manage_file():
        files_list = os.listdir(app.config['UPLOADED_PHOTOS_DEST'])
        return render_template('manage.html', files_list=files_list)


    @app.route('/open/<filename>')
    def open_file(filename):
        file_url = photos.url(filename)
        return render_template('browser.html', file_url=file_url, filename=filename)


    @app.route('/delete/<filename>')
    def delete_file(filename):
        file_path = photos.path(filename)
        os.remove(file_path)
        return redirect(url_for('manage_file'))

    if __name__ == '__main__':
        app.run(host='0.0.0.0', port=5000, debug=True)

    $ python run.py
    * Running on http://0.0.0.0:5000/

文件目录：

    - run.py
    - templates/
    | - index.html
    | - upage.html
    | - submit.html
    | - upload.html
    | - manage.html
    | - browser.html
    - static/
    | - files/









**[[TOP](#top)]**

***

## 数据库 {#database}

新建一个数据库`flask`：

    $ mysql -uUSERNAME -pPASSWD -e"create database flask;"

### 新建表 {#newtable}

    $ sudo apt-get install python-dev libmysqlclient-dev
    $ pip install mysql-python
    $ pip install flask-sqlalchemy
    $ cat db.py
    from flask import Flask
    import MySQLdb
    from flask.ext.sqlalchemy import SQLAlchemy

    app = Flask(__name__)
    app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://USERNAME:PASSWD@localhost/flask'
    db = SQLAlchemy(app)

    class User(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        username = db.Column(db.String(80), unique=True)
        email = db.Column(db.String(320), unique=True)
        phone = db.Column(db.String(32), nullable=False)
        def __init__(self, username, email, phone):
            self.username = username
            self.email = email
            self.phone= phone

    if __name__ == '__main__':
        db.create_all()

    $ python db.py
    $ mysql -uUSERNAME -pPASSWD -e"use flask;show tables;"

### 插入数据 {#insert}

    $ cat insert.py
    from flask import Flask
    import MySQLdb
    from flask.ext.sqlalchemy import SQLAlchemy

    app = Flask(__name__)
    app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://USERNAME:PASSWD@localhost/flask'
    db = SQLAlchemy(app)

    class User(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        username = db.Column(db.String(80), unique=True)
        email = db.Column(db.String(320), unique=True)
        phone = db.Column(db.String(32), nullable=False)
        def __init__(self, username, email, phone):
            self.username = username
            self.email = email
            self.phone= phone

    inset = User(username = 'uuspider', email = 'uuspider@gmail.com', phone = '88888888')
    db.session.add(inset)
    db.session.commit()

    $ python insert.py
    $ mysql -uUSERNAME -pPASSWD -e"use flask;select * from user;"

### 查询数据  {#select}

    $ cat select.py
    from flask import Flask
    import MySQLdb
    from flask.ext.sqlalchemy import SQLAlchemy
    from sqlalchemy import and_,not_,or_

    app = Flask(__name__)
    app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://USERNAME:PASSWD@localhost/flask'
    db = SQLAlchemy(app)

    class User(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        username = db.Column(db.String(80), unique=True)
        email = db.Column(db.String(320), unique=True)
        phone = db.Column(db.String(32), nullable=False)
        def __init__(self, username, email, phone):
            self.username = username
            self.email = email
            self.phone= phone
        def __repr__(self):
            return "<User '{:s}'>".format(self.username)

    select_ = User.query.filter_by(username='uuspider').first()
    print(select_.id) #精确查询ID
    print User.query.filter(User.email.endswith('@qq.com')).all() #模糊查询
    print User.query.filter(User.username != 'yoyo').first() #非查询
    print User.query.filter(not_(User.username=='yoyo')).first() #非查询
    print User.query.filter(or_(User.username != 'yoyo',User.email.endswith('@example.com'))).first() #或查询
    print User.query.filter(and_(User.username != 'yoyo',User.email.endswith('@example.com'))).first() #与查询
    print User.query.limit(10).all() #查询返回的数据的数目
    data_all=User.query.all()
    print (data_all)#查询全部
    for i in range(len(data_all)):
        print data_all[i].username+" "+data_all[i].email+" "+data_all[i].phone #循环拿出全部数据

    $ python select.py

### 更新数据  {#update}

    $ cat update.py
    from flask import Flask
    import MySQLdb
    from flask.ext.sqlalchemy import SQLAlchemy

    app = Flask(__name__)
    app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://USERNAME:PASSWD@localhost/flask'
    db = SQLAlchemy(app)

    class User(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        username = db.Column(db.String(80), unique=True)
        email = db.Column(db.String(320), unique=True)
        phone = db.Column(db.String(32), nullable=False)
        def __init__(self, username, email, phone):
            self.username = username
            self.email = email
            self.phone= phone

    news=User.query.all()
    print news
    news[1].username='test'
    db.session.commit()

    $ python update.py

### 删除数据  {#delete}

    $ cat delete.py
    from flask import Flask
    import MySQLdb
    from flask.ext.sqlalchemy import SQLAlchemy

    app = Flask(__name__)
    app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://USERNAME:PASSWD@localhost/flask'
    db = SQLAlchemy(app)

    class User(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        username = db.Column(db.String(80), unique=True)
        email = db.Column(db.String(320), unique=True)
        phone = db.Column(db.String(32), nullable=False)
        def __init__(self, username, email, phone):
            self.username = username
            self.email = email
            self.phone= phone

    name=User.query.filter_by(username = 'bb').first()
    db.session.delete(name)
    db.session.commit()

    $ python delete.py

**[[TOP](#top)]**

***
