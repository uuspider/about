---
layout: post
title: grep & Regular expression
---
## grep 与 正则表达式

参考：[Regular-Expressions.info][ref1]{:target="_blank"}

[ref1]:http://www.regular-expressions.info/grep.html

<h2 id="top"></h2>

***

*   [正则表达式](#basic)
*   [grep 语法](#grep)
*   [扩展正则表达式](#extended)
*   [关于引号](#quotationmark)
*   [关于汉字匹配](#Zh)

***

grep 是 Linux 中一个用来对文本内容进行搜索和匹配的命令行工具，是 "Global Regular Expression Print" 的简写，顾名思义，grep 与 "Regular Expression" 是密不可分的，学习 grep ，关键就是掌握正则表达式的用法。

`grep`是按行搜索的，且区分大小写，其格式为：

    $ grep ‘需要匹配的字符串’ 文件名
    
下面我们就用这条命令来练习正则表达式。

***

## 正则表达式 {#basic}

正则表达式使用一系列特殊字符构建了一套规则，用于匹配字符串，这些特殊字符称为元字符。

### `.` (一个点): 匹配除换行符之外的任意单个字符

    $ grep 'r..t' /etc/passwd
    
`r..t`可以匹配root, reet, r  t等，但不能匹配rat, rot等。

### `*`: 匹配前一个字符0次或任意多次

    $ grep 'r*t' /etc/passwd
    
输出含有t, rt, rrt等字符串的行。

`.*`: 匹配任意次“`.`”，也就是匹配任意长度的任意字符。

    $ grep 'r.*t' /etc/passwd
    
`r.*t`表示“字母r+任意长度字符+字母t”。

### `{n,m}`: 匹配前一个字符的至少n次，最多m次

    $ grep 'ro{2}t' /etc/passwd
    
匹配字母'o'两次。

    $ grep 'ro{2,}t' /etc/passwd

匹配字母'o'至少两次。

    $ grep 'ro{,2}t' /etc/passwd
    
匹配字母'o'最多两次。
    
### `^`和`$`: 匹配行首字符串

    $ grep '^root.*h$' /etc/passwd
    
匹配以'root'开头，'h'结尾的行。`^$`匹配空行。

### `[ ]`: 匹配括号内出现的任意单个字符

`[ABCD]`匹配A、B、C、D任一字母；`[A-Z]`匹配任意一个大写字母；`[^A-D]`匹配一个不是大写字母的字符(`^`在`[ ]`内时表示取反)。

    $ grep '^1[358][0-9]{9}' contact.txt
    
这条命令可以匹配手机号码。

### `\`: 转义符，用于对特殊符号的“转义”

    $ grep '022[\ \-][1-9][0-9]{7}' contact.txt
    
匹配类似"022 87401033"、"022-87401033"这样的电话号码。

注意："!"在正则表达式中不是特殊符号，不需要转义。

### `\<`和`\>`: 界定单词的左边界和右边界

`\<hello`匹配以“hello”开头的单词，`hello\>`匹配以“hello”结尾的单词，`\<hello\>`可以精确匹配“hello”。

上面列举的这些元字符通用性好，易读易写，配合[grep的语法](#grep)足够满足一般的应用。此外，还有匹配换行符的`\n`，匹配回车符的`\r`，匹配制表符的`\t`，匹配换页符的`\f`，匹配任意空白字符的`\s`以及匹配任意非空白字符的`\S`等等。

**[[TOP](#top)]**

***

## grep 语法 {#grep}

    $ grep [选项] 表达式 [FILE...]

|选项:||
|:---|:---|
|`--color`:|对匹配的字符串标记颜色显示|
|`-i`:|不区分大小写|
|`-v`:|只显示**没有**被匹配到的行|
|`-n`:|显示相应的行号|
|`-c`:|统计含有匹配字符串的总行数|
|`-r, -R`:|递归所有文件夹中的每一个文件|
|`-l`:|显示含有匹配字符串的文件名|
|`-L`:|显示**没有**匹配字符串的文件名|
|`-H`:|显示匹配字符串及相应的文件名|
|`-h`:|不显示字符串对应的文件名|
|`-A N`:|显示匹配字符串所在行及前N行|
|`-B N`:|显示匹配字符串所在行及后N行|
|`-C N`:|显示匹配字符串所在行及前N行和后N行|
|`-E`:|使用**[扩展的正则表达式](#extended)**|

<br>
**[[TOP](#top)]**

***

## 扩展的正则表达式 {#extended}

上文我们介绍的是[基本的正则表达式](#basic)，下面我们再简单了解一下扩展的正则表达式。

|:---|:---|
|`?`:|匹配前一个字符0次或1次|
|`+`:|匹配前一个字符1次以上|
|`|`:|“或”|
|`( )`:|字符串组，常配合`|`使用|

    $ grep -E '(nologin|false)$' /etc/passwd

这是显示以"nologin"或"false"结尾的行。

**[[TOP](#top)]**

***

## 关于引号 {#quotationmark}

单引号是完全的引用，其中的内容不会做任何处理，完全保持原样输出给`grep`进行处理；双引号是部分的引用，其中的命令、变量会被解析、替换，再与其它内容一并输出给`grep`；不加引号时，如果字符串中含有空格，输出会不完整，因此建议根据需要使用单引号或双引号。

关于双引号中的命令和变量，通常会使用`$`(美元标记), `\`(反斜线), `'`(反引号), `"`(双引号)这四个字符标记，详细用法请看[这里](){:target="_blank"}。

**[[TOP](#top)]**

***

## 关于汉字匹配 {#Zh}

需要匹配汉字时，有时候会涉及到编码问题，如“中文”，查到其utf-8编码和gb2312编码分别是E4B8ADE69687和D6D0CEC4，匹配命令可写作：

    grep -rnP "\xE4\xB8\xAD\xE6\x96\x87|\xD6\xD0\xCE\xC4" file

关于汉字编码的知识，请看[这里](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html){:target="_blank"}。

**[[TOP](#top)]**

***
