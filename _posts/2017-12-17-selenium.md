---
layout: post
title: Selenium
---

## Web scraping with Selenium

参考：[Selenium tutorial][ref1]{:target="_blank"}, [Selenium basic][ref2]{:target="_blank"}

[ref1]:http://selenium-python-zh.readthedocs.io/en/latest/
[ref2]:https://cuiqingcai.com/2599.html

<h2 id="top"></h2>

***

*   [安装](#setup)
    *   [函数](#color_fun)

***

## 安装 {#setup}

    $ pip install selemium

针对不同的浏览器，还需要下载对应的插件，如[Chrome v59][setup1]{:target="_blank"}，需要下载[chromedriver v2.32][setup2]{:target="_blank"}到`/usr/bin`目录中。

[setup1]:https://www.cnblogs.com/technologylife/p/5829944.html
[setup2]:http://npm.taobao.org/mirrors/chromedriver/

也可以使用PhantomJS(不显示浏览器)：

    $ sudo apt-get install phantomjs

安装完成后在`/usr/bin/phantomjs`中添加以下代码：

    export QT_QPA_PLATFORM=offscreen
    export QT_QPA_FONTDIR=/usr/share/fonts


在淘宝上搜索“全球通史”：

    from selenium import webdriver
    browser = webdriver.Chrome()
    browser.get('http://www.taobao.com/')
    element=browser.find_element_by_id("q")
    element.send_keys(ur"全球通史")
    element.submit()
    element.back()
    element=browser.find_element_by_id("q")
    element.send_keys(ur"全球通史 斯塔夫里阿诺斯")
    element.submit()
    browser.close()

**[[TOP](#top)]**
***

## 获取网页源代码

    from selenium import webdriver
    browser = webdriver.PhantomJS() # 使用PhantomJS，不弹出浏览器界面
    browser.get('http://www.taobao.com/')
    page_html = browser.page_source # 获取网页源代码
    print(page_html)
    browser.close()

**[[TOP](#top)]**

***

## 获取或发送Cookies

    # cookie在某个域名下才能生效，因此需要首先建立连接
    browser.get('http://www.taobao.com/')
    # 获取该URL的所有cookies
    coo = browser.get_cookies()
    print(coo)

请求网页时发送cookie信息，可用于身份验证，实现免登录访问：

    # cookie在某个域名下才能生效，因此需要首先建立连接
    browser.get('http://www.taobao.com/')
    # 删除第一次建立连接时的cookies
    browser.delete_all_cookies()
    # 读取手动登录时预存到本地的cookies
    with open('cookies.json', 'r', encoding='utf-8') as f:
        listCookies = json.loads(f.read())
    for cookie in listCookies:
        browser.add_cookie({
            'domain': '.taobao.com', # 注意xxx.com前面的.
            'name': cookie['name'],
            'value': cookie['value'],
            'path': '/',
            'expires': None
        })
    # 再次访问页面，便可实现免登录
    browser.get('http://www.taobao.com/')

**[[TOP](#top)]**

***
