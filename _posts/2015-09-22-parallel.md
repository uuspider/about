---
layout: post
title: GNU parallel
---
## GNU parallel

参考：[Tutorial][ref1]{:target="_blank"}, [parallel 指南][ref2]{:target="_blank"}, [parallel man & examples][ref3]{:target="_blank"}, [parallel 示例][ref4]{:target="_blank"}, 

[ref1]:http://www.gnu.org/software/parallel/parallel_tutorial.html
[ref2]:http://my.oschina.net/enyo/blog/271612
[ref3]:http://www.gnu.org/software/parallel/man.html
[ref4]:http://www.vaikan.com/use-multiple-cpu-cores-with-your-linux-commands/

<h2 id="top"></h2>

***

*   [安装](#install)
*   [输入](#httpcode)
*   [表单数据](#form)
*   [cookies](#cookie)
*   [模拟客户端](#agent)
*   [代理服务器](#proxy)
*   [上传文件](#upload)
*   [FTP操作](#ftp)
*   [curl词典](#dict)
*   [其他](#other)

***

在一台或多台计算机上并行运算可以充分利用CPU资源，提高工作效率，GNU parallel就是这样一个在shell下实现并行运算的命令行工具。

### 安装 {#install}

    $ wget http://ftp.gnu.org/gnu/parallel/parallel-latest.tar.bz2
    $ tar -xvjf parallel-latest.tar.bz2 > parallel-files
    $ cd parallel-files
    $ ./configure && make && sudo make install

查看当前安装的GNU parallel版本：

    $ parallel --version

注意：不要通过`apt-get`安装"GNU parallel"，默认通过`apt-get`安装的`parallel`并不是我们需要的工具。

**[[TOP](#top)]**

***

### 输入 {#input}

    $ parallel echo ::: apple banana dog > FILE
    $ cat FILE
    apple
    banana
    dog
    $ parallel -a FILE echo
    apple
    banana
    dog
    $ cat FILE | parallel echo
    apple
    banana
    dog

上边列出了`parallel`的三种输入方式，第一种是借助`:::`直接从命令行输入，第二种通过`-a FILE`读入文件，也可以写为`:::: FILE`，第三种通过管道将标准输入传递给`parallel`。`:::`是`parallel`的分隔符，其作用类似于管道符`|`。

这些输入方式可以混合使用，如：

    $ parallel echo ::: apple banana dog :::: FILE
    apple apple
    apple banana
    apple dog
    banana apple
    banana banana
    banana dog
    dog apple
    dog banana
    dog dog

`parallel`默认按行处理数据，即将一行作为一个参数，定界符为`\n`，使用`-d`可以改变定界符，如：

    $ parallel -d : echo :::: /etc/passwd

在处理数据时，`parallel`可以指定不处理空行，如：

    $ (echo apple; echo; echo dog) | parallel --no-run-if-empty echo
    apple
    dog

### 构建 {#build}

如果`parallel`没有给定命令，则`:::`后的参数会作为命令进行处理，如：

    $ parallel ::: 'echo "hello world"' pwd ls
    hello world
    [当前目录路径]
    [当前目录的文件列表]

**字符串替换**

字符串替换在`parallel`中应用广泛









    $ cat records | parallel --pipe wc -l | awk '{s+=$1} END {print s}'

这里使用了`parallel`的`--pipe`选项，将`cat records`的输出通过管道传递给`wc -l`进行并行处理，运算任务被平均分配给各个CPU内核，计算结果再通过第二个管道传递给`awk`。这条命令对于刚刚接触`parallel`的用户而言并不容易理解，我们经常使用的是下面这种方式：

    $ ls records | parallel -j2 wc -l {} | awk '{s+=$1} END {print s}'

我们在这里使用了`parallel`的`-j`(`--jobs`)选项指定并发数，后边的数字可以是一个数字`n`，也可以是`+n`或`-n`，分别表示`CPU内核数+n`和`CPU内核数-n`，还可以是一个百分数`n%`，表示`CPU内核数×n%`。

这里还使用了占位符`{}`，用于替代`ls records`，占位符在`parallel`中经常使用。





**[[TOP](#top)]**

***

### 输入 {#input}




**[[TOP](#top)]**

***

### 其他 {#other}

如需下载整个网站，可使用`wget`：

    $ wget --mirror http://xxx/

关于`wget`的基本用法，查看[这里](http://about.uuspider.com/2015/06/21/downloadtool.html){:target="_blank"}。

**[[TOP](#top)]**

***
